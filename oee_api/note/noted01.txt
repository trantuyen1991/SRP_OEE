1ï¸âƒ£ Má»¥c tiÃªu dá»± Ã¡n

XÃ¢y dá»±ng API OEE phá»¥c vá»¥ dashboard trÃªn AVEVA Edge.

API láº¥y dá»¯ liá»‡u tá»« MySQL (fact_production_min, dim_packaging, dim_shift_calendar) vÃ  tráº£ vá» JSON gá»“m:

Gauges (Availability, Performance, Quality, OEE)

Linechart (bucket tá»± Ä‘á»™ng â‰¤ 2000 Ä‘iá»ƒm)

Summaries (shift/day/week/month/quarter/year).

Äáº£m báº£o cháº¡y á»•n Ä‘á»‹nh, trÃ¡nh NaN/Inf gÃ¢y lá»—i JSON, há»— trá»£ cache TTL Ä‘á»ƒ nhiá»u widget gá»i Ä‘á»“ng thá»i.

2ï¸âƒ£ CÃ¡c cáº£i tiáº¿n Ä‘Ã£ lÃ m

TÃ¡ch nhá» code & logging rÃµ rÃ ng (docstring, comments, log cho tá»«ng bÆ°á»›c).

ThÃªm CORS cho client (AVEVA, LAN).

Bá»• sung cache TTL theo (line_id, time range, bucket_sec) Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng káº¿t quáº£.

ThÃªm endpoint /oee/dashboard/line/{line_id} gom snapshot Ä‘áº§y Ä‘á»§ (gauges + linechart + 6 summaries).

Xá»­ lÃ½ tá»± Ä‘á»™ng bucket trong build_sql_range Ä‘á»ƒ giá»›i háº¡n sá»‘ Ä‘iá»ƒm linechart.

Viáº¿t láº¡i cÃ´ng thá»©c OEE = APQ vá»›i ngoáº·c chuáº©n â†’ khÃ´ng lá»—i SQL.

Fix lá»—i MySQL ONLY_FULL_GROUP_BY cho view (quarter, month, â€¦).

Xá»­ lÃ½ NaN/Inf á»Ÿ 2 lá»›p:

Trong _df_to_records (DataFrame â†’ JSON).

ThÃªm _sanitize_json_deep lÃ m â€œlÆ°á»›i an toÃ nâ€ trÆ°á»›c khi tráº£ response.

3ï¸âƒ£ Tá»“n táº¡i & hÆ°á»›ng tiáº¿p theo

Cáº§n finalize hÃ m _build_sql_range cho range/gran mode tháº­t sáº¡ch (hiá»‡n Ä‘Ã£ á»•n, chá»‰ cáº§n kiá»ƒm thá»­ thÃªm).

Kiá»ƒm tra láº¡i key tráº£ JSON (linechart thá»‘ng nháº¥t, bá» linchart).

Tá»‘i Æ°u thÃªm: cÃ³ thá»ƒ gom API call vÃ  cache nhiá»u hÆ¡n (trÃ¡nh query DB láº·p).

Bá»• sung test cases:

since_min ngáº¯n (cÃ³ NaN),

from/to dÃ i (bucket auto),

filter theo process_order, packaging_id.

4ï¸âƒ£ Äiá»ƒm má»‘c Ä‘á»ƒ báº¯t Ä‘áº§u topic má»›i

ChÃºng ta Ä‘Ã£ cÃ³ 3 block code chÃ­nh:

Helpers, sanitize, cache

/oee/line/{line_id} (range/gran mode)

/oee/dashboard/line/{line_id} (snapshot Ä‘áº§y Ä‘á»§)

Váº¥n Ä‘á» lá»›n nháº¥t Ä‘Ã£ giáº£i quyáº¿t: NaN gÃ¢y lá»—i JSON, ngoáº·c SQL sai, view quarter lá»—i.

Giá» cÃ³ thá»ƒ báº¯t Ä‘áº§u topic má»›i vá»›i focus:

Refactor code thÃ nh module tÃ¡ch biá»‡t (vd: queries.py, utils.py, api.py)

Tá»‘i Æ°u hiá»‡u nÄƒng query (index, partition)

Bá»• sung unit test vÃ  Postman collection Ä‘á»ƒ verify káº¿t quáº£.

ğŸ‘‰ TÃ³m gá»n: API OEE Ä‘Ã£ cháº¡y á»•n cho from/to, cáº§n hoÃ n thiá»‡n ná»‘t gran mode (since_min) vÃ  dá»n code thÃ nh cáº¥u trÃºc chuáº©n Ä‘á»ƒ dá»… má»Ÿ rá»™ng.